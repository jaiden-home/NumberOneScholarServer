# Number One Scholar Server

符合行业最佳实践的 Express.js 后端服务，采用模块化、可维护的目录结构设计。

## 目录结构

```
NumberOneScholarServer/
├── config/             # 配置目录
│   └── index.js        # 配置管理模块
├── controllers/        # 控制器层
│   └── userController.js  # 用户控制器
├── data/               # 数据访问层
│   └── mysql/          # MySQL 数据访问
│       ├── db.js       # 数据库连接池管理
│       ├── init.sql    # 数据库初始化脚本
│       └── userRepository.js  # 用户数据访问
├── middleware/         # 中间件目录
│   ├── errorHandler.js # 全局错误处理中间件
│   └── validator.js    # 请求验证中间件
├── routes/             # 路由层
│   └── userRoutes.js   # 用户路由
├── services/           # 服务层
│   └── userService.js  # 用户服务
├── utils/              # 公共工具目录
│   ├── errors.js       # 自定义错误类
│   └── logger.js       # 日志记录系统
├── .env                # 环境变量配置
├── .env.example        # 环境变量示例
├── ENVIRONMENT.md      # 环境配置说明
├── index.js            # 主应用文件
├── package.json        # 项目配置和依赖
└── README.md           # 项目说明文档
```

## 目录职责说明

### 1. config/（配置目录）

负责管理项目的所有配置项，包括：
- 服务器配置（端口、环境）
- 数据库配置（连接信息、池大小）
- 日志配置（级别、格式）
- CORS 配置

配置项通过环境变量加载，支持不同环境的配置切换。

### 2. controllers/（控制器层）

处理 HTTP 请求和响应，包括：
- 接收和解析请求参数
- 调用服务层处理业务逻辑
- 构造和返回响应
- 错误处理和传递

控制器层严格遵循 RESTful API 设计规范，确保 API 接口的一致性和可读性。

### 3. data/（数据访问层）

负责与数据库的交互，包括：
- 数据库连接池管理
- SQL 查询构建和执行
- 数据模型映射
- 事务处理

数据访问层采用参数化查询，防止 SQL 注入攻击，同时提供清晰的数据访问接口。

### 4. middleware/（中间件目录）

包含各种中间件，包括：
- 全局错误处理中间件
- 请求验证中间件
- 日志记录中间件
- 认证授权中间件（可扩展）

中间件用于处理横切关注点，确保核心业务逻辑的纯净性。

### 5. routes/（路由层）

定义 API 路由和端点，包括：
- 路由路径配置
- 请求方法映射
- 中间件应用
- 请求验证规则定义

路由层采用模块化设计，便于管理和扩展不同功能模块的 API。

### 6. services/（服务层）

实现核心业务逻辑，包括：
- 业务规则验证
- 数据处理和转换
- 服务间调用
- 事务协调

服务层是业务逻辑的核心，确保业务规则的一致性和可维护性。

### 7. utils/（公共工具目录）

提供通用工具和辅助功能，包括：
- 自定义错误类
- 日志记录系统
- 工具函数（可扩展）
- 常量定义（可扩展）

工具目录集中管理通用功能，提高代码复用率。

## 核心功能

### 1. 模块化架构

采用分层架构设计，严格遵循关注点分离原则：
- 路由层：负责请求路由和验证
- 控制器层：负责请求处理和响应
- 服务层：负责业务逻辑实现
- 数据访问层：负责数据库交互

### 2. 错误处理机制

实现完整的错误处理体系：
- 自定义错误类（验证错误、数据库错误、业务逻辑错误等）
- 全局错误处理中间件
- 差异化错误响应策略
- 开发/生产环境错误信息控制

### 3. 请求验证

集成 express-validator 实现严格的请求验证：
- 输入参数验证
- 标准化验证错误响应
- 验证规则复用

### 4. 日志记录系统

使用 Winston 实现结构化日志：
- 多级别日志（info、warn、error）
- 上下文信息（请求 ID、时间戳、用户信息）
- 日志文件轮转
- 开发/生产环境日志格式

### 5. 数据库连接管理

实现高效的数据库连接池：
- 连接池配置和管理
- 连接错误处理和重连机制
- 参数化查询防止 SQL 注入
- 支持 RDS MySQL 基础系列倚天版

## API 端点

### 健康检查

- `GET /health` - 检查服务状态

### 用户管理

- `GET /api/users` - 获取所有用户
- `GET /api/users/:id` - 获取单个用户
- `POST /api/users` - 创建用户
- `PUT /api/users/:id` - 更新用户
- `DELETE /api/users/:id` - 删除用户

## 技术栈

- **框架**：Express.js 5.x
- **数据库**：MySQL 5.7+（RDS MySQL 基础系列倚天版）
- **ORM/查询**：mysql2/promise
- **验证**：express-validator
- **日志**：Winston
- **配置**：dotenv
- **开发工具**：ESLint、Prettier、Nodemon

## 启动方式

详细的环境配置和启动说明请参考 [ENVIRONMENT.md](ENVIRONMENT.md) 文件。

## 代码规范

- 遵循 JavaScript 编码规范
- 使用 ESLint 进行代码质量检查
- 使用 Prettier 进行代码格式化
- 提供清晰的代码注释
- 采用一致的命名约定

## 安全措施

- 使用参数化查询防止 SQL 注入
- 实现请求验证防止恶意输入
- 错误处理中避免暴露敏感信息
- 数据库连接池管理防止连接泄漏
- 日志记录中避免记录敏感数据